HALT	EQU	04FDH

INITIATE:	ORG	8000H
	MOV	R5, #00H	;FOR FIRST ADDR
	MOV	R2, #05H	;COUNTER
	MOV	R3, #00H	;LENGTH
	MOV	R4, #00H	;CHECKSUM
	MOV	R0, #00H	;DPL
	MOV	R1, #000H	;DPH
	MOV	88H, #00H	;SETTING TCON
	MOV	89H, #20H	;SETTING TMOD
	MOV	8DH, #0FDH	; SETTING TH1
	MOV	87H, #00H	;SETTING SMOD
	MOV	98H, #50H	;SETTING SCON
	MOV	0A8H, #90H	;SETTING INTERRUPT ENABLE
	SETB	TR1		;SET THE TIMER
	SETB	32H
	CLR	33H
	CLR	30H

READY:	MOV	70H, #90H
	MOV	71H, #05H
	LCALL	print
	INC	70H
	MOV	71H, #097H
	LCALL	print
	INC	70H
	MOV	71H, #77H
	LCALL	print
	INC	70H
	MOV	71H, #0E5H
	LCALL	print
	INC	70H
	MOV	71H, #0E6H
	LCALL	print


STAGE1:	SETB	31H
	JB	31H, $
	CJNE	R2, #05H, J		;loop it to stage1
	SJMP	J8			;HERE I MADE A CHANGE
J:	JB	33H,STAGE1
	CJNE	R2, #00H, STAGE1	;CHECK R2
	JNB	30H, J7
	SJMP	J8		;EOF

J7:	MOV	A, SBUF
	LCALL	18ADH
	INC	DPTR
	DEC	R3
	CJNE	R3, #00H, STAGE1
	SETB	32H
	MOV	A, R4
	SUBB	A, SBUF		;CHECKSUM WE GOT
	CPL	A
	ADD	A, #01h
	MOV	R4, A
	CJNE	A, SBUF, J8	;HERE I MADE A CHANGE
	SETB	32H	
	SETB	33H		;HERE WE GO  AGAIN
	SJMP	STAGE1

J8:	LJMP	addrsub	;PRINT DONE

J9:	MOV	70H, #90H	;PRINT ERROR
	MOV	71H, #00H
	LCALL	print
	INC	70H
	MOV	71H, #097H
	LCALL	print
	INC	70H
	MOV	71H, #05H
	LCALL	print
	INC	70H
	LCALL	print		
	
shap:	ORG	0F050H
	MOV	DPTR,#1BB7H
	MOVC	A,@A+DPTR
	MOV	71H,A
	LCALL	print
	RET
print:	ORG	0F000H
	MOV	DPTR, #0EC01H
	MOV	A, 70H
	MOVX	@DPTR, A
	MOV	DPTR, #0EC00H
	MOV	A, 71H
	MOVX	@DPTR, A
	RET
addrsub:	ORG	0B000H
	MOV	A,R7
	ANL	A,#0F0H
	SWAP	A
	MOV	70H, #90H
	LCALL	shap
	MOV	A,R7
	ANL	A,#0FH
	INC	70H
	LCALL	shap
	MOV	A,R6
	ANL	A,#0F0H
	SWAP	A
	INC	70H
	LCALL	shap
	MOV	A,R6
	ANL	A,#0FH
	INC	70H
	LCALL	shap
	MOV	71H,#0D3H
	INC	70H
	LCALL	print
	MOV	71H,#0F3H
	INC	70H
	LCALL	print
	MOV	R0,50H

input:	LCALL	02A2H
	MOV	@R0,A
	INC	R0
	CJNE	A,#1FH,input
	DEC	R0
	DEC	R0
	MOV	A,@R0
	MOV	R3,A
	DEC	R0
	MOV	A,@R0
	SWAP	A
	ADD	A,R3
	MOV	DPL,A
	DEC	R0
	MOV	A,@R0
	MOV	R3,A
	DEC	R0
	MOV	A,@R0
	SWAP	A
	ADD	A,R3
	MOV	DPH,A
	MOV	R0,DPL
	MOV	R1,DPH
	MOV	A,#02H
	LCALL	18ADH
	INC	DPTR
	MOV	A,R7
	LCALL	18ADH
	INC	DPTR
	MOV	A,R6
	LCALL	18ADH
	MOV	DPTR,#0B075H
	MOV	A,#02H
	LCALL	18ADH
	INC	DPTR
	MOV	A,R1
	LCALL	18ADH
	INC	DPTR
	MOV	A,R0
	LCALL	18ADH
	
	
	
		
SUB:	org	0023H
	LJMP	subroutine
		

subroutine:	ORG	0FFF9H
	LJMP	subroutine1

subroutine1:	
	ORG	0C000H
	CLR	31H
	MOV	A, SBUF
	JNB	32H, J1
	CJNE	A, #3AH, J1
	INC	R5
	CLR	32H
	MOV	R2, #04H
	CLR	RI
	RETI

J1:	ADD	A, R4
	MOV	R4, A
	CJNE	R2, #04H, J2
	DEC	R2
	MOV	R3, SBUF
	CLR	RI
	RETI
	
J2:	CJNE	R2, #03H, J3
	DEC	R2
	MOV	DPH,SBUF
	CJNE	R5, #01H,JJ1
	MOV	R7,DPH
	
JJ1:	CLR	RI
	RETI
	
J3:	CJNE	R2, #02H, J4
	DEC	R2
	MOV	DPL,SBUF
	CJNE	R5, #01H,JJ2
	MOV	R6,DPL
	
JJ2:	CLR	RI
	RETI
	
J4:	CJNE	R2, #01H, J6
	DEC	R2
	SETB	33H
	MOV	A, SBUF
	CJNE	A, #01H, J5
	CLR	33H
	SETB	30H
	CLR	RI
	RETI

J5:	CLR	RI
	RETI

J6:	CLR	33H
	CLR	RI
	RETI
END