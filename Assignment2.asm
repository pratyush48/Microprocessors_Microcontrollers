HALT	EQU	04FDH




INITIALIZE:	ORG	8000H
	MOV	31H, #0FDH
	MOV	32H, #00H
	MOV	33H, #3AH	; HEADER START
	MOV	34H, #00H	;LENGTH
	MOV	35H, #0B0H	;START ADDRESS HIGH
	MOV	36H, #00H	;START ADDRESS LOW
	MOV	37H, #00H	;TYPE
	MOV	38H, #0B0H	;STOP ADDRESS HIGH
	MOV	39H, #01FH	;STOP ADDRESS LOW
	MOV	R0, #00H
	MOV	88H, #00H	;SETTING TCON
	MOV	89H, #20H	;SETTING TMOD
	MOV	8DH, 31H	; SETTING TH1
	MOV	87H, #00H	;SETTING SMOD
	MOV	98H, #50H	;SETTING SCON
	MOV	0A8H, #90H	;SETTING INTERRUPT ENABLE


LOOP1:	LCALL addrsub
	MOV	A, 38H
	CLR	C
	SUBB	A, 35H
	JNC	JUMP
	SJMP	EOF
JUMP:	CJNE	A, #00H, JUMP1
	MOV	A, 39H
	CLR	C
	SUBB	A, 36H
	JNC	JUMP2
	SJMP	EOF

JUMP2:
	CJNE	A, #00H, J2
	LJMP	HALT
J2:	MOV	34H, A
	CLR	C
	JNC	JUMP3
JUMP1:
	MOV	34H, #0FFH

JUMP3:
	MOV	R1, #00H	;STAGE REGISTER
	MOV	R2, #00H	;CHECKSUM REGISTER
	MOV	R0, #33H	;LENGTH REGISTER
	MOV	TCON, #40H
STAGE1:
	SETB	31H
	MOV	SBUF, @R0
	JB	31H, $
	MOV	A, @R0
	ADD	A, R2
	MOV	R2, A
	CJNE	R0, #38H, STAGE1
	MOV	DPH, 35H
	MOV	DPL, 36H
	MOV	R3, 37H
STAGE2:
	SETB	31H
	MOVX	A, @DPTR
	MOV	SBUF, A
	JB	31H, $
	ADD	A, R2
	MOV	R2, A
	INC	DPTR
	DEC	R3
	CJNE	R3, #00H, STAGE2
	INC	DPTR
	MOV	A, R2
	CPL	A
	ADD	A, #01h
	SETB	31h
	mov	r6, a
	MOV	SBUF, A
	JB	31H, $
	MOV	35H, DPH
	MOV	36H, DPL
	SJMP	LOOP1

EOF:	SETB	31H
	MOV	SBUF,#3AH
	JB	31H,$
	SETB	31H
	MOV	SBUF,#00H
	JB	31H,$
	SETB	31H
	MOV	SBUF,#00H
	JB	31H,$
	SETB	31H
	MOV	SBUF,#00H
	JB	31H,$
	SETB	31H	
	MOV	SBUF,#01H
	JB	31H,$
	SETB	31H
	MOV	SBUF,#0FFH
	JB	31H,$
	SETB	31H
	LJMP	dOnE

dOnE:	MOV	70H, #90H
	MOV	71H, #0E5H
	LCALL	printsub
	INC	70H
	MOV	71H, #0F3H
	LCALL	printsub
	INC	70H
	MOV	71H, #45H
	LCALL	printsub
	INC	70H
	MOV	71H, #97H
	LCALL	printsub
	SJMP	dOnE

printsub:	ORG	0F000H
	MOV	DPTR, #0EC01H
	MOV	A, 70H
	MOVX	@DPTR, A
	MOV	DPTR, #0EC00H
	MOV	A, 71H
	MOVX	@DPTR, A
	RET
	
addrsub:	ORG	0E000H
	MOV	A,35H
	ANL	A,#0F0H
	SWAP	A
	MOV	70H, #90H
	LCALL	shap
	MOV	A,35H
	ANL	A,#0FH
	INC	70H
	LCALL	shap
	MOV	A,36H
	ANL	A,#0F0H
	SWAP	A
	INC	70H
	LCALL	shap
	MOV	A,36H
	ANL	A,0FH
	INC	70H
	LCALL	shap
	RET
	
shap:	ORG	0F050H
	MOV	DPTR,#1BB7H
	MOVC	A,@A+DPTR
	MOV	71H,A
	LCALL	printsub
	RET
	
SUB:	org	0023H
	LJMP	subroutine


subroutine:	ORG	0FFF9H
	CLR	31H
	CLR	TI
	INC	R0
	RETI









